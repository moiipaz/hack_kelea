{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="text-danger"><i class="fas fa-robot"></i> Chatbot de Apoyo Emocional</h2>
    <p>ğŸ’¬ Escribe un mensaje y el chatbot responderÃ¡ segÃºn tu estado emocional.</p>

    <input type="text" id="mensajeInput" class="form-control" placeholder="Escribe aquÃ­...">
    <button class="btn btn-primary mt-3 w-100" onclick="enviarMensaje()">Enviar</button>

    <h3 class="mt-4">ğŸ—¨ï¸ ConversaciÃ³n</h3>
    <ul id="chatHistorial" class="list-group"></ul>

    <h3 class="mt-4">ğŸ“Š Tendencias Emocionales</h3>
    <p id="tendencias"></p>
</div>

<script>
    function enviarMensaje() {
        let mensaje = document.getElementById("mensajeInput").value;
        fetch("/chatbot", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ texto: mensaje })
        })
        .then(response => response.json())
        .then(data => {
            let historial = document.getElementById("chatHistorial");
            let li = document.createElement("li");
            li.classList.add("list-group-item");
            li.innerHTML = `<strong>ğŸ‘¤ TÃº:</strong> ${mensaje} <br>
                            <strong>ğŸ¤– Chatbot:</strong> ${data.respuesta} <br>
                            ğŸ˜ƒ EmociÃ³n detectada: <strong>${data.emocion}</strong>`;
            historial.appendChild(li);
            document.getElementById("mensajeInput").value = "";
        })
        .catch(error => console.error("Error:", error));
    }

    function cargarTendencias() {
        fetch("/chatbot/tendencias")
        .then(response => response.json())
        .then(data => {
            document.getElementById("tendencias").innerHTML = `<strong>${data.tendencias}</strong>`;
        });
    }

    window.onload = cargarTendencias;
</script>
{% endblock %}
